<!-- Navigation -->
<nav class="nav">
    <div class="nav-container">
        <a href="#" class="nav-logo" data-base-path>tsuzuki817</a>
        <div class="nav-menu">
            <a href="#" class="nav-link" data-nav-portfolio>Portfolio</a>
            <a href="#" class="nav-link" data-nav-blog>Blog</a>
            <a href="#" class="nav-link" data-nav-about>About</a>
            <a href="#" class="nav-link" data-nav-contact>Contact</a>
            <div class="language-switcher">
                <div class="lang-dropdown">
                    <button class="lang-current">
                        <span class="lang-text" data-current-lang>日本語</span>
                        <span class="lang-arrow">▼</span>
                    </button>
                    <div class="lang-options" data-lang-options>
                        <!-- Language options will be injected by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
        <div class="nav-toggle">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </div>
</nav>

<script>
(function() {
    // Get current page info
    const fullPath = window.location.pathname;
    const pathParts = fullPath.split('/').filter(Boolean);
    
    // Detect language and get page path
    let currentLang = 'ja';
    let pagePath = [...pathParts]; // Copy array
    
    if (pathParts[0] === 'en') {
        currentLang = 'en';
        pagePath.shift(); // Remove language prefix
    } else if (pathParts[0] === 'ko') {
        currentLang = 'ko';
        pagePath.shift(); // Remove language prefix
    }
    
    // Calculate base path to root
    let basePath = '';
    const totalDepth = pathParts.length;
    
    if (totalDepth === 0) {
        // We're at root
        basePath = '';
    } else {
        // Calculate '../' based on depth
        basePath = '../'.repeat(totalDepth);
    }
    
    // Helper function to build correct path
    function buildPath(targetLang, pagePathArray) {
        let result = basePath;
        
        // Add language prefix if not Japanese
        if (targetLang !== 'ja') {
            result += targetLang + '/';
        }
        
        // Add page path
        if (pagePathArray.length > 0) {
            result += pagePathArray.join('/') + '/';
        }
        
        return result;
    }
    
    // Set logo link
    const logoLink = document.querySelector('[data-base-path]');
    if (logoLink) {
        logoLink.href = buildPath(currentLang, []);
    }
    
    // Set navigation links
    const navLinks = {
        'data-nav-portfolio': ['portfolio'],
        'data-nav-blog': ['blog', 'posts'],
        'data-nav-about': ['about'],
        'data-nav-contact': ['contact']
    };
    
    Object.keys(navLinks).forEach(selector => {
        const link = document.querySelector(`[${selector}]`);
        if (link) {
            link.href = buildPath(currentLang, navLinks[selector]);
        }
    });
    
    // Set current language text
    const langText = document.querySelector('[data-current-lang]');
    if (langText) {
        const langNames = {
            'ja': '日本語',
            'en': 'English',
            'ko': '한국어'
        };
        langText.textContent = langNames[currentLang];
    }
    
    // Generate language options
    const langOptions = document.querySelector('[data-lang-options]');
    if (langOptions) {
        const languages = [
            { code: 'en', name: 'English' },
            { code: 'ja', name: '日本語' },
            { code: 'ko', name: '한국어' }
        ];
        
        languages.forEach(lang => {
            const option = document.createElement('a');
            option.className = 'lang-option';
            
            if (lang.code === currentLang) {
                option.className += ' active';
                option.href = '#';
                option.innerHTML = `${lang.name} <span class="lang-check">✓</span>`;
            } else {
                // Build path for language switch
                option.href = buildPath(lang.code, pagePath);
                option.textContent = lang.name;
            }
            
            langOptions.appendChild(option);
        });
    }
    
    // Mobile menu toggle
    const navToggle = document.querySelector('.nav-toggle');
    const navMenu = document.querySelector('.nav-menu');
    
    if (navToggle && navMenu) {
        navToggle.addEventListener('click', function() {
            navMenu.classList.toggle('active');
            navToggle.classList.toggle('active');
        });
    }
    
    // Language dropdown toggle
    const langDropdown = document.querySelector('.lang-dropdown');
    const langCurrent = document.querySelector('.lang-current');
    
    if (langDropdown && langCurrent) {
        langCurrent.addEventListener('click', function(e) {
            e.stopPropagation();
            langDropdown.classList.toggle('active');
        });
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function() {
            langDropdown.classList.remove('active');
        });
    }
})();
</script>