<!-- Navigation -->
<nav class="nav">
    <div class="nav-container">
        <a href="/" class="nav-logo" data-nav-logo>tsuzuki817</a>
        <div class="nav-menu">
            <a href="/portfolio/" class="nav-link" data-nav-portfolio>Portfolio</a>
            <a href="/blog/posts/" class="nav-link" data-nav-blog>Blog</a>
            <a href="/about/" class="nav-link" data-nav-about>About</a>
            <a href="/contact/" class="nav-link" data-nav-contact>Contact</a>
            <div class="language-switcher">
                <div class="lang-dropdown">
                    <button class="lang-current">
                        <span class="lang-text" data-current-lang>日本語</span>
                        <span class="lang-arrow">▼</span>
                    </button>
                    <div class="lang-options" data-lang-options>
                        <!-- Language options will be generated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
        <div class="nav-toggle">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </div>
</nav>

<script>
(function() {
    // Language configuration
    const LANGUAGES = {
        ja: { name: '日本語', path: '' },
        en: { name: 'English', path: 'en' },
        ko: { name: '한국어', path: 'ko' }
    };
    
    // Get current language from URL or localStorage
    function getCurrentLanguage() {
        const path = window.location.pathname;
        
        // Check URL for language
        if (path.startsWith('/en/')) return 'en';
        if (path.startsWith('/ko/')) return 'ko';
        
        // Default to Japanese for root paths
        return 'ja';
    }
    
    // Save language preference
    function saveLanguagePreference(lang) {
        localStorage.setItem('preferredLanguage', lang);
    }
    
    // Get saved language preference
    function getSavedLanguage() {
        return localStorage.getItem('preferredLanguage') || 'ja';
    }
    
    // Get current page path without language prefix
    function getPagePath() {
        const path = window.location.pathname;
        const currentLang = getCurrentLanguage();
        
        if (currentLang === 'en') {
            return path.replace(/^\/en/, '');
        } else if (currentLang === 'ko') {
            return path.replace(/^\/ko/, '');
        }
        
        return path;
    }
    
    // Build URL for language switch
    function buildLanguageUrl(targetLang) {
        const pagePath = getPagePath();
        
        if (targetLang === 'ja') {
            // Japanese is at root
            return pagePath || '/';
        } else {
            // Other languages have prefix
            return '/' + targetLang + pagePath;
        }
    }
    
    // Update navigation links based on current language
    function updateNavigationLinks() {
        const currentLang = getCurrentLanguage();
        const prefix = currentLang === 'ja' ? '' : '/' + currentLang;
        
        // Update logo link
        const logoLink = document.querySelector('[data-nav-logo]');
        if (logoLink) {
            logoLink.href = prefix + '/';
        }
        
        // Update navigation links
        const navLinks = {
            '[data-nav-portfolio]': '/portfolio/',
            '[data-nav-blog]': '/blog/posts/',
            '[data-nav-about]': '/about/',
            '[data-nav-contact]': '/contact/'
        };
        
        Object.entries(navLinks).forEach(([selector, path]) => {
            const link = document.querySelector(selector);
            if (link) {
                link.href = prefix + path;
            }
        });
    }
    
    // Initialize language display
    function initializeLanguage() {
        const currentLang = getCurrentLanguage();
        const savedLang = getSavedLanguage();
        
        // Save current language
        saveLanguagePreference(currentLang);
        
        // Update current language display
        const langText = document.querySelector('[data-current-lang]');
        if (langText) {
            langText.textContent = LANGUAGES[currentLang].name;
        }
        
        // Generate language options
        const langOptionsContainer = document.querySelector('[data-lang-options]');
        if (langOptionsContainer) {
            Object.entries(LANGUAGES).forEach(([code, lang]) => {
                const option = document.createElement('a');
                option.className = 'lang-option';
                option.dataset.lang = code;
                
                if (code === currentLang) {
                    option.href = '#';
                    option.className += ' active';
                    option.innerHTML = `${lang.name} <span class="lang-check">✓</span>`;
                } else {
                    option.href = buildLanguageUrl(code);
                    option.textContent = lang.name;
                    
                    // Add click handler to save preference
                    option.addEventListener('click', function(e) {
                        saveLanguagePreference(code);
                    });
                }
                
                langOptionsContainer.appendChild(option);
            });
        }
        
        // Update navigation links
        updateNavigationLinks();
    }
    
    // Check if user should be redirected based on saved preference
    function checkLanguageRedirect() {
        const currentLang = getCurrentLanguage();
        const savedLang = getSavedLanguage();
        
        // Only redirect on homepage visits
        if (window.location.pathname === '/' || 
            window.location.pathname === '/en/' || 
            window.location.pathname === '/ko/') {
            
            if (savedLang !== currentLang) {
                // User has a different language preference
                const redirectUrl = buildLanguageUrl(savedLang);
                if (redirectUrl !== window.location.pathname) {
                    // Optional: Uncomment to enable auto-redirect
                    // window.location.href = redirectUrl;
                }
            }
        }
    }
    
    // Mobile menu toggle
    const navToggle = document.querySelector('.nav-toggle');
    const navMenu = document.querySelector('.nav-menu');
    
    if (navToggle && navMenu) {
        navToggle.addEventListener('click', function() {
            navMenu.classList.toggle('active');
            navToggle.classList.toggle('active');
        });
    }
    
    // Language dropdown toggle
    const langDropdown = document.querySelector('.lang-dropdown');
    const langCurrent = document.querySelector('.lang-current');
    
    if (langDropdown && langCurrent) {
        langCurrent.addEventListener('click', function(e) {
            e.stopPropagation();
            langDropdown.classList.toggle('active');
        });
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function() {
            langDropdown.classList.remove('active');
        });
    }
    
    // Initialize everything
    initializeLanguage();
    checkLanguageRedirect();
    
    // Expose language info globally
    window.siteLanguage = {
        current: getCurrentLanguage(),
        saved: getSavedLanguage(),
        available: LANGUAGES
    };
})();
</script>