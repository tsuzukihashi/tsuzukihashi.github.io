<!-- Navigation -->
<nav class="nav">
    <div class="nav-container">
        <a href="#" class="nav-logo" data-base-path>tsuzuki817</a>
        <div class="nav-menu">
            <a href="#" class="nav-link" data-nav-portfolio>Portfolio</a>
            <a href="#" class="nav-link" data-nav-blog>Blog</a>
            <a href="#" class="nav-link" data-nav-about>About</a>
            <a href="#" class="nav-link" data-nav-contact>Contact</a>
            <div class="language-switcher">
                <div class="lang-dropdown">
                    <button class="lang-current">
                        <span class="lang-text" data-current-lang>日本語</span>
                        <span class="lang-arrow">▼</span>
                    </button>
                    <div class="lang-options" data-lang-options>
                        <!-- Language options will be injected by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
        <div class="nav-toggle">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </div>
</nav>

<script>
(function() {
    // Get current page info
    const path = window.location.pathname;
    const pathParts = path.split('/').filter(Boolean);
    
    // Detect language
    let currentLang = 'ja';
    let langPrefix = '';
    let basePath = '/';
    
    if (pathParts[0] === 'en') {
        currentLang = 'en';
        langPrefix = '/en';
        pathParts.shift();
    } else if (pathParts[0] === 'ko') {
        currentLang = 'ko';
        langPrefix = '/ko';
        pathParts.shift();
    }
    
    // Calculate base path based on directory depth
    const depth = pathParts.length;
    if (depth > 0) {
        basePath = '../'.repeat(depth);
        if (basePath === '') basePath = './';
    }
    
    // Adjust base path for language subdirectories
    if (langPrefix) {
        if (depth === 0) {
            basePath = '../';
        }
    }
    
    // Set logo link
    const logoLink = document.querySelector('[data-base-path]');
    if (logoLink) {
        logoLink.href = basePath + (langPrefix ? langPrefix.slice(1) + '/' : '');
    }
    
    // Set navigation links
    const navLinks = {
        'data-nav-portfolio': 'portfolio/',
        'data-nav-blog': 'blog/posts/',
        'data-nav-about': 'about/',
        'data-nav-contact': 'contact/'
    };
    
    Object.keys(navLinks).forEach(selector => {
        const link = document.querySelector(`[${selector}]`);
        if (link) {
            link.href = basePath + (langPrefix ? langPrefix.slice(1) + '/' : '') + navLinks[selector];
        }
    });
    
    // Set current language text
    const langText = document.querySelector('[data-current-lang]');
    if (langText) {
        const langNames = {
            'ja': '日本語',
            'en': 'English',
            'ko': '한국어'
        };
        langText.textContent = langNames[currentLang];
    }
    
    // Generate language options
    const langOptions = document.querySelector('[data-lang-options]');
    if (langOptions) {
        const languages = [
            { code: 'en', name: 'English' },
            { code: 'ja', name: '日本語' },
            { code: 'ko', name: '한국어' }
        ];
        
        languages.forEach(lang => {
            const option = document.createElement('a');
            option.className = 'lang-option';
            
            if (lang.code === currentLang) {
                option.className += ' active';
                option.href = '#';
                option.innerHTML = `${lang.name} <span class="lang-check">✓</span>`;
            } else {
                // Calculate the path for language switch
                let targetPath = basePath;
                
                if (lang.code === 'ja') {
                    // Japanese is at root
                    targetPath = basePath;
                } else {
                    // Other languages are in subdirectories
                    targetPath = basePath + lang.code + '/';
                }
                
                // Add the current page path
                if (pathParts.length > 0) {
                    targetPath += pathParts.join('/') + '/';
                }
                
                option.href = targetPath;
                option.textContent = lang.name;
            }
            
            langOptions.appendChild(option);
        });
    }
    
    // Mobile menu toggle
    const navToggle = document.querySelector('.nav-toggle');
    const navMenu = document.querySelector('.nav-menu');
    
    if (navToggle && navMenu) {
        navToggle.addEventListener('click', function() {
            navMenu.classList.toggle('active');
            navToggle.classList.toggle('active');
        });
    }
    
    // Language dropdown toggle
    const langDropdown = document.querySelector('.lang-dropdown');
    const langCurrent = document.querySelector('.lang-current');
    
    if (langDropdown && langCurrent) {
        langCurrent.addEventListener('click', function(e) {
            e.stopPropagation();
            langDropdown.classList.toggle('active');
        });
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function() {
            langDropdown.classList.remove('active');
        });
    }
})();
</script>